(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{621:function(s,a,t){"use strict";t.r(a);var e=t(5),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-1-mq-的相关概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-mq-的相关概念"}},[s._v("#")]),s._v(" 1.1. MQ 的相关概念")]),s._v(" "),t("h3",{attrs:{id:"_1-1-1-什么是-mq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-什么是-mq"}},[s._v("#")]),s._v(" 1.1.1. 什么是 MQ")]),s._v(" "),t("p",[s._v("MQ(message queue)，从字面意思上看，本质是个队列， FIFO 先入先出，只不过队列中存放的内容是message 而已，还是一种跨进程的通信机制，用于上下游传递消息。在互联网架构中， MQ 是一种非常常见的上下游“逻辑解耦+物理解耦”的消息通信服务。使用了 MQ 之后，消息发送上游只需要依赖MQ，不用依赖其他服务。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-2-为什么要用-mq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-为什么要用-mq"}},[s._v("#")]),s._v(" 1.1.2. 为什么要用 MQ")]),s._v(" "),t("h4",{attrs:{id:"_1-流量消峰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-流量消峰"}},[s._v("#")]),s._v(" 1.流量消峰")]),s._v(" "),t("p",[s._v("举个例子，如果订单系统最多能处理一万次订单，这个处理能力应付正常时段的下单时绰绰有余，正常时段我们下单一秒后就能返回结果。但是在高峰期，如果有两万次下单操作系统是处理不了的，只能限制订单超过一万后不允许用户下单。使用消息队列做缓冲，我们可以取消这个限制，把一秒内下的订单分散成一段时间来处理，这时有些用户可能在下单十几秒后才能收到下单成功的操作，但是比不能下单的体验要好。")]),s._v(" "),t("h4",{attrs:{id:"_2-应用解耦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-应用解耦"}},[s._v("#")]),s._v(" 2.应用解耦")]),s._v(" "),t("p",[s._v("以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统。用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障，都会造成下单操作异常。当转变成基于消息队列的方式后，系统间调用的问题会减少很多，比如物流系统因为发生故障，需要几分钟来修复。在这几分钟的时间里，物流系统要处理的内存被缓存在消息队列中，用户的下单操作可以正常完成。当物流系统恢复后，继续处理订单信息即可，中单用户感受不到物流系统的故障， 提升系统的可用性。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121141633627.png",alt:"image-20220121141633627"}})]),s._v(" "),t("h4",{attrs:{id:"_3-异步处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-异步处理"}},[s._v("#")]),s._v(" 3.异步处理")]),s._v(" "),t("p",[s._v("有些服务间调用是异步的，例如 A 调用 B， B 需要花费很长时间执行，但是 A 需要知道 B 什么时候可以执行完，以前一般有两种方式， A 过一段时间去调用 B 的查询 api 查询。或者 A 提供一个 callback api，B 执行完之后调用 api 通知 A 服务。这两种方式都不是很优雅， 使用消息总线，可以很方便解决这个问题，A 调用 B 服务后，只需要监听 B 处理完成的消息，当 B 处理完成后，会发送一条消息给 MQ， MQ 会将此消息转发给 A 服务。这样 A 服务既不用循环调用 B 的查询 api，也不用提供 callback api。同样 B 服务也不用做这些操作。 A 服务还能及时的得到异步处理成功的消息。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121141704195.png",alt:"image-20220121141704195"}})]),s._v(" "),t("h3",{attrs:{id:"_1-1-3-mq-的分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-mq-的分类"}},[s._v("#")]),s._v(" 1.1.3. MQ 的分类")]),s._v(" "),t("h4",{attrs:{id:"_1-activemq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-activemq"}},[s._v("#")]),s._v(" 1.ActiveMQ")]),s._v(" "),t("p",[s._v("优点： 单机吞吐量万级，时效性 ms 级，可用性高，基于主从架构实现高可用性，消息可靠性较低的概率丢失数据")]),s._v(" "),t("p",[s._v("缺点:官方社区现在对 ActiveMQ 5.x "),t("strong",[s._v("维护越来越少， 高吞吐量场景较少使用")]),s._v("。")]),s._v(" "),t("h4",{attrs:{id:"_2-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-kafka"}},[s._v("#")]),s._v(" 2.Kafka")]),s._v(" "),t("p",[s._v("大数据的杀手锏，谈到大数据领域内的消息传输，则绕不开 Kafka，这款为"),t("strong",[s._v("大数据而生")]),s._v("的消息中间件，以其**百万级 TPS **的吞吐量名声大噪，迅速成为大数据领域的宠儿，在数据采集、传输、存储的过程中发挥着举足轻重的作用。目前已经被 LinkedIn， Uber, Twitter, Netflix 等大公司所采纳。")]),s._v(" "),t("p",[s._v("优点: 性能卓越，单机写入 TPS 约在百万条/秒，最大的优点，就是"),t("strong",[s._v("吞吐量高")]),s._v("。时效性 ms 级可用性非常高， kafka 是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用,消费者采用 Pull 方式获取消息, 消息有序, 通过控制能够保证所有消息被消费且仅被消费一次;有优秀的第三方Kafka Web 管理界面 Kafka-Manager；在日志领域比较成熟，被多家公司和多个开源项目使用；功能支持：功能较为简单，主要支持简单的 MQ 功能，在大数据领域的"),t("strong",[s._v("实时计算")]),s._v("以及"),t("strong",[s._v("日志采集")]),s._v("被大规模使用")]),s._v(" "),t("p",[s._v("缺点： Kafka 单机超过 64 个队列/分区， Load 会发生明显的飙高现象，队列越多， load 越高，发送消息响应时间变长， 使用短轮询方式，实时性取决于轮询间隔时间， 消费失败不支持重试； 支持消息顺序，但是一台代理宕机后，就会产生消息乱序， "),t("strong",[s._v("社区更新较慢")]),s._v("；")]),s._v(" "),t("h4",{attrs:{id:"_3-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-rocketmq"}},[s._v("#")]),s._v(" 3.RocketMQ")]),s._v(" "),t("p",[s._v("RocketMQ 出自阿里巴巴的开源产品，用 Java 语言实现，在设计时参考了 Kafka，并做出了自己的一些改进。被阿里巴巴广泛应用在订单，交易，充值，流计算，消息推送，日志流式处理， binglog 分发等场景。")]),s._v(" "),t("p",[s._v("优点："),t("strong",[s._v("单机吞吐量十万级")]),s._v("，可用性非常高，分布式架构，"),t("strong",[s._v("消息可以做到 0 丢失")]),s._v("，MQ功能较为完善，还是分布式的，扩展性好，"),t("strong",[s._v("支持 10 亿级别的消息堆积")]),s._v("，不会因为堆积导致性能下降,源码是 java 我们可以自己阅读源码，定制自己公司的 MQ")]),s._v(" "),t("p",[s._v("缺点： "),t("strong",[s._v("支持的客户端语言不多")]),s._v("，目前是 java 及 c++，其中 c++不成熟；社区活跃度一般,没有在 MQ核心中去实现 JMS 等接口,有些系统要迁移需要修改大量代码")]),s._v(" "),t("h4",{attrs:{id:"_4-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-rabbitmq"}},[s._v("#")]),s._v(" 4.RabbitMQ")]),s._v(" "),t("p",[s._v("2007 年发布，是一个在 AMQP(高级消息队列协议)基础上完成的，可复用的企业消息系统，是"),t("strong",[s._v("当前最主流的消息中间件之一")]),s._v("。")]),s._v(" "),t("p",[s._v("优点：由于 erlang 语言的"),t("strong",[s._v("高并发特性")]),s._v("，性能较好； "),t("strong",[s._v("吞吐量到万级")]),s._v("， MQ 功能比较完备,健壮、稳定、易用、跨平台、 **支持多种语言 **如： Python、 Ruby、 .NET、 Java、 JMS、 C、 PHP、 ActionScript、 XMPP、 STOMP等，支持 AJAX 文档齐全；开源提供的管理界面非常棒，用起来很好用，"),t("strong",[s._v("社区活跃度高")]),s._v("； 更新频率相当高")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.rabbitmq.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("缺点：商业版需要收费,学习成本较高")]),s._v(" "),t("h3",{attrs:{id:"_1-1-4-mq-的选择"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-mq-的选择"}},[s._v("#")]),s._v(" 1.1.4. MQ 的选择")]),s._v(" "),t("h4",{attrs:{id:"_1-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-kafka"}},[s._v("#")]),s._v(" 1.Kafka")]),s._v(" "),t("p",[s._v("Kafka 主要特点是基于 Pull 的模式来处理消息消费，追求高吞吐量，一开始的目的就是用于日志收集和传输，适合产生"),t("strong",[s._v("大量数据")]),s._v("的互联网服务的数据收集业务。 "),t("strong",[s._v("大型公司")]),s._v("建议可以选用，如果有"),t("strong",[s._v("日志采集")]),s._v("功能，肯定是首选 kafka 了。")]),s._v(" "),t("h4",{attrs:{id:"_2-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-rocketmq"}},[s._v("#")]),s._v(" 2.RocketMQ")]),s._v(" "),t("p",[s._v("天生为"),t("strong",[s._v("金融互联网")]),s._v("领域而生，对于可靠性要求很高的场景，尤其是电商里面的订单扣款， 以及业务削峰，在大量交易涌入时，后端可能无法及时处理的情况。 RoketMQ 在稳定性上可能更值得信赖，这些业务场景在阿里双 11 已经经历了多次考验，如果你的业务有上述并发场景，建议可以选择 RocketMQ。")]),s._v(" "),t("h4",{attrs:{id:"_3-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-rabbitmq"}},[s._v("#")]),s._v(" 3.RabbitMQ")]),s._v(" "),t("p",[s._v("结合 erlang 语言本身的并发优势，性能好"),t("strong",[s._v("时效性微秒级")]),s._v("， "),t("strong",[s._v("社区活跃度也比较高")]),s._v("，管理界面用起来十分方便， 如果你的"),t("strong",[s._v("数据量没有那么大")]),s._v("， 中小型公司优先选择功能比较完备的 RabbitMQ。")]),s._v(" "),t("h2",{attrs:{id:"_1-2-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-rabbitmq"}},[s._v("#")]),s._v(" 1.2. RabbitMQ")]),s._v(" "),t("h3",{attrs:{id:"_1-2-1-rabbitmq-的概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-rabbitmq-的概念"}},[s._v("#")]),s._v(" 1.2.1. RabbitMQ 的概念")]),s._v(" "),t("p",[s._v("RabbitMQ 是一个消息中间件：它接受并转发消息。你可以把它当做一个快递站点，当你要发送一个包裹时，你把你的包裹放到快递站，快递员最终会把你的快递送到收件人那里，按照这种逻辑 RabbitMQ 是一个快递站，一个快递员帮你传递快件。 RabbitMQ 与快递站的主要区别在于，它不处理快件而是接收，存储和转发消息数据。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-2-四大核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-四大核心概念"}},[s._v("#")]),s._v(" 1.2.2. 四大核心概念")]),s._v(" "),t("p",[s._v("生产者")]),s._v(" "),t("p",[s._v("​\t\t产生数据发送消息的程序是生产者")]),s._v(" "),t("p",[s._v("交换机")]),s._v(" "),t("p",[s._v("​\t\t交换机是 RabbitMQ 非常重要的一个部件，一方面它接收来自生产者的消息，另一方面它将消息推送到队列中。交换机必须确切知道如何处理它接收到的消息，是将这些消息推送到特定队列还是推送到多个队列，亦或者是把消息丢弃，这个得有交换机类型决定")]),s._v(" "),t("p",[s._v("队列")]),s._v(" "),t("p",[s._v("​\t\t队列是 RabbitMQ 内部使用的一种数据结构， 尽管消息流经 RabbitMQ 和应用程序，但它们只能存储在队列中。队列仅受主机的内存和磁盘限制的约束，本质上是一个大的消息缓冲区。许多生产者可以将消息发送到一个队列，许多消费者可以尝试从一个队列接收数据。这就是我们使用队列的方式")]),s._v(" "),t("p",[s._v("消费者")]),s._v(" "),t("p",[s._v("​\t\t消费与接收具有相似的含义。消费者大多时候是一个等待接收消息的程序。 请注意生产者，消费者和消息中间件很多时候并不在同一机器上。同一个应用程序既可以是生产者又是可以是消费者。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-3-rabbitmq-核心部分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-rabbitmq-核心部分"}},[s._v("#")]),s._v(" 1.2.3. RabbitMQ 核心部分")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121142733140.png",alt:"image-20220121142733140"}})]),s._v(" "),t("h3",{attrs:{id:"_1-2-4-各个名词介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-各个名词介绍"}},[s._v("#")]),s._v(" 1.2.4. 各个名词介绍")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121142750943.png",alt:"image-20220121142750943"}})]),s._v(" "),t("p",[t("strong",[s._v("Broker")]),s._v("：接收和分发消息的应用， RabbitMQ Server 就是 Message Broker")]),s._v(" "),t("p",[t("strong",[s._v("Virtual host")]),s._v("：出于多租户和安全因素设计的，把 AMQP 的基本组件划分到一个虚拟的分组中，类似于网络中的 namespace 概念。当多个不同的用户使用同一个 RabbitMQ server 提供的服务时，可以划分出多个 vhost，每个用户在自己的 vhost 创建 exchange／ queue等")]),s._v(" "),t("p",[t("strong",[s._v("Connection")]),s._v("： publisher／ consumer 和 broker 之间的 TCP 连接")]),s._v(" "),t("p",[t("strong",[s._v("Channel")]),s._v("：如果每一次访问 RabbitMQ 都建立一个 Connection，在消息量大的时候建立 TCP Connection 的开销将是巨大的，效率也较低。 Channel 是在 connection 内部建立的逻辑连接，如果应用程序支持多线程，通常每个 thread 创建单独的 channel 进行通讯，AMQP method 包含了 channel id 帮助客户端和 message broker 识别 channel，所以 channel 之间是完全隔离的。 Channel 作为轻量级的"),t("strong",[s._v("Connection 极大减少了操作系统建立 TCP connection 的开销")])]),s._v(" "),t("p",[t("strong",[s._v("Exchange")]),s._v("： message 到达 broker 的第一站，根据分发规则，匹配查询表中的 routing key，分发消息到 queue 中去。常用的类型有：direct (point-to-point), topic (publish-subscribe) and fanout (multicast)")]),s._v(" "),t("p",[t("strong",[s._v("Queue")]),s._v("： 消息最终被送到这里等待 consumer 取走")]),s._v(" "),t("p",[t("strong",[s._v("Binding")]),s._v("： exchange 和 queue 之间的虚拟连接， binding 中可以包含 routing key， Binding 信息被保存到 exchange 中的查询表中，用于 message 的分发依据")]),s._v(" "),t("h3",{attrs:{id:"_1-2-5-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-安装"}},[s._v("#")]),s._v(" 1.2.5. 安装")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("官网地址\nhttps://www.rabbitmq.com/download.html")])]),s._v(" "),t("li",[t("p",[s._v("文件上传\n上传到/usr/local/software 目录下(如果没有 software 需要自己创建)")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121144536518.png",alt:"image-20220121144536518"}})])]),s._v(" "),t("li",[t("p",[s._v("安装文件")]),s._v(" "),t("p",[s._v("由于RabbitMQ是erlang语言写的，我们需要先安装erlang语言环境")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh erlang-21.3-1.el7.x86_64.rpm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("安装socat网络工具")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" socat -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("安装RabbitMQ")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动服务")]),s._v(" "),t("p",[s._v("添加开机启动 RabbitMQ 服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" rabbitmq-server on\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/sbin/service rabbitmq-server start\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看服务状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/sbin/service rabbitmq-server status\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121145010590.png",alt:"image-20220121145010590"}})]),s._v(" "),t("p",[s._v("停止服务(选择执行)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/sbin/service rabbitmq-server stop\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("开启web插件管理")]),s._v(" "),t("p",[s._v("需要先停止服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/sbin/service rabbitmq-server stop\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("开启web插件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmq-plugins "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rabbitmq_management\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后启动服务")]),s._v(" "),t("p",[s._v("用默认账号密码(guest)访问地址 http://192.168.10.40:15672/出现权限问题")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://coderdu.com/image/image-20220121145341381.png",alt:"image-20220121145341381"}})])]),s._v(" "),t("li",[t("p",[s._v("添加一个新的用户")]),s._v(" "),t("p",[s._v("创建账号")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl add_user admin "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("设置用户角色")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl set_user_tags admin administrator\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看当前用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl list_users\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("常用命令")]),s._v(" "),t("p",[t("strong",[s._v("虚拟主机")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("           ```bash\n           # 创建虚拟主机：\n           rabbitmqctl add_vhost vhost_service\n           rabbitmqctl add_vhost vhost_client\n           \n           # 删除虚拟主机：\n           rabbitmqctl delete_vhost vhost_service\n           rabbitmqctl delete_vhost vhost_client\n           \n           # 查看虚拟主机信息：\n           rabbitmqctl list_vhosts\n           ```\n")])])]),t("p",[t("strong",[s._v("用户")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建用户密码：")]),s._v("\nrabbitmqctl add_user root rabbitmq_root\nrabbitmqctl add_user client_publish rabbitmq_publish\nrabbitmqctl add_user client_subscribe rabbitmq_subscribe\nrabbitmqctl add_user "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" rabbitmq_service\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除用户：")]),s._v("\nrabbitmqctl delete_user root\nrabbitmqctl delete_user client_publish\nrabbitmqctl delete_user client_subscribe\nrabbitmqctl delete_user "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看用户信息：")]),s._v("\nrabbitmqctl list_users\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户权限：")]),s._v("\nrabbitmqctl set_user_tags root administrator\nrabbitmqctl set_user_tags "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" monitoring\nrabbitmqctl set_user_tags client_publish monitoring\nrabbitmqctl set_user_tags client_subscribe monitoring\n\ntags就是账号权限\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、超级管理员"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("administrator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n可登陆管理控制台，可查看所有的信息，并且可以对用户，策略"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("进行操作。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、监控者"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("monitoring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n可登陆管理控制台，同时可以查看rabbitmq节点的相关信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("进程数，内存使用情况，磁盘使用情况等"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、策略制定者"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policymaker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的相关信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("上图红框标识的部分"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、普通管理者"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、其他\n无法登陆管理控制台，通常就是普通的生产者和消费者。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("p",[t("strong",[s._v("设置用户访问虚拟机权限")]),s._v("：")]),s._v(" "),t("p",[s._v("​\t\t授予用户可访问虚拟主机，在所有资源上都具备可配置，可写及可读的权限。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置权限：")]),s._v("\nrabbitmqctl set_permissions -p vhost_service root "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v("\nrabbitmqctl set_permissions -p vhost_client root "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v("\nrabbitmqctl set_permissions -p vhost_service "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v("\n\nrabbitmqctl set_permissions -p vhost_client client_publish "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v("\nrabbitmqctl set_permissions -p vhost_client client_subscribe "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清除权限：")]),s._v("\nrabbitmqctl clear_permissions vhost_service -p "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\nrabbitmqctl clear_permissions vhost_client -p client_publish\nrabbitmqctl clear_permissions vhost_client -p client_subscribe\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重置命令")]),s._v(" "),t("p",[s._v("关闭应用的命令为")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl stop_app\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("清除的命令为")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl reset\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重新启动命令为")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rabbitmqctl start_app\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);