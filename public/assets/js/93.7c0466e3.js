(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{660:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"springboot启动过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot启动过程"}},[t._v("#")]),t._v(" SpringBoot启动过程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606210009066.png",alt:"image-20210606210009066"}})]),t._v(" "),a("ol",[a("li",[a("p",[t._v("创建SpringBootApplication")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("保存了资源加载器resourceLoader")])]),t._v(" "),a("li",[a("p",[t._v("断言primarySources是否为空")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606210133874.png",alt:"image-20210606210133874"}})])]),t._v(" "),a("li",[a("p",[t._v("保存SpringBootApplication启动类的位置到this.primarySources")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606210614995.png",alt:"image-20210606210614995"}})])]),t._v(" "),a("li",[a("p",[t._v("判断web应用的类型webApplicationType")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606210810798.png",alt:"image-20210606210810798"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606210832813.png",alt:"image-20210606210832813"}})])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("bootstrappers")]),t._v("初始启动引导器（List"),a("Bootstrapper"),t._v("）去spring.factories中找org.springframework.boot."),a("code",[t._v("Bootstrapper")]),t._v("类型的配置")],1)]),t._v(" "),a("li",[a("p",[t._v("setInitializers去spring.factories中找==ApplicationContextInitializer==，保存List<ApplicationContextInitializer<?>> initializers")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606221653519.png",alt:"image-20210606221653519"}})])]),t._v(" "),a("li",[a("p",[t._v("setListeners去spring.factories找==ApplicationListener==应用监听器，保存List<ApplicationListener<?>> listeners")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606221803399.png",alt:"image-20210606221803399"}})])]),t._v(" "),a("li",[a("p",[t._v("mainApplicationClass找到主程序this.mainApplicationClass = deduceMainApplicationClass();")]),t._v(" "),a("p",[t._v("main方法下的")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606222240560.png",alt:"image-20210606222240560"}})])])])]),t._v(" "),a("li",[a("p",[t._v("运行SpringBootApplication")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210606223245039.png",alt:"image-20210606223245039"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建"),a("strong",[t._v("StopWatch")]),t._v("，停止监听器，监听应用创建时长")])]),t._v(" "),a("li",[a("p",[t._v("开启"),a("strong",[t._v("StopWatch")]),t._v("，记录应用启动时间")])]),t._v(" "),a("li",[a("p",[t._v("创建引导上下文(Context环境)，createBootstrapContext()")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建默认的DefaultBootstrapContext")])]),t._v(" "),a("li",[a("p",[t._v("遍历配置的"),a("strong",[t._v("bootstrappers")]),t._v("初始启动引导器"),a("code",[t._v("在spring.factories找到的")]),t._v("，调用Bootstrapper的intitialize方法，来完成对引导启动器上下文环境设置，"),a("code",[t._v("this.bootstrappers.forEach((initializer) -> initializer.intitialize(bootstrapContext));")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bootstrapper")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * Initialize the given {@link BootstrapRegistry} with any required registrations.\n    * @param registry the registry to initialize\n    */")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("intitialize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BootstrapRegistry")]),t._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])])])]),t._v(" "),a("li",[a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("  创建应用上下文配置\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigurableApplicationContext")]),t._v(" context "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("让当前应用进入headless模式，"),a("strong",[t._v("java.awt.headless")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("获取所有getRunListeners（运行监听器）")]),a("code",[t._v("为了方便所有Listener进行事件感知")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("getRunListeners去spring.factories找==SpringApplicationRunListener==")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplicationRunListeners")]),t._v(" listeners "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRunListeners")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210607002052432.png",alt:"image-20210607002052432"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210607002524457.png",alt:"image-20210607002524457"}})])])])]),t._v(" "),a("li",[a("p",[t._v("遍历所有的SpringApplicationRunListeners，调用starting方法")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("相当于通知所有感兴趣系统正在启动的人，项目正在starting")])])])]),t._v(" "),a("li",[a("p",[t._v("保存命令行参数：ApplicationArguments")])]),t._v(" "),a("li",[a("p",[t._v("准备环境信息：prepareEnvironment")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("返回或者创建基础环境信息对象：getOrCreateEnvironment")]),t._v(" "),a("p",[t._v("当前环境是：StandardServletEnvironment")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210607004046206.png",alt:"image-20210607004046206"}})])]),t._v(" "),a("li",[a("p",[t._v("配置环境信息对象：configureEnvironment(environment, applicationArguments.getSourceArgs());")]),t._v(" "),a("ul",[a("li",[t._v("读取所有的配置源的配置属性值：configurePropertySources(environment, args);")])])]),t._v(" "),a("li",[a("p",[t._v("绑定环境信息：ConfigurationPropertySources.attach(environment);")])]),t._v(" "),a("li",[a("p",[t._v("监听器调用"),a("code",[t._v("listeners.environmentPrepared()方法")]),t._v("，通知所有的监听器当前环境准备完成")])])])]),t._v(" "),a("li",[a("p",[t._v("创建IOC容器信息"),a("code",[t._v("createApplicationContext()")])]),t._v(" "),a("ul",[a("li",[t._v("会根据项目类型（servlet）创建容器")]),t._v(" "),a("li",[t._v("当前会创建"),a("strong",[t._v("AnnotationConfigServletWebServerApplicationContext")])])])]),t._v(" "),a("li",[a("p",[t._v("准备ApplicationContext IOC容器的基本信息 prepareContext()")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("保存环境信息")])]),t._v(" "),a("li",[a("p",[t._v("IOC容器的后置处理流程")])]),t._v(" "),a("li",[a("p",[t._v("应用初始化器applyInitializers；")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("遍历所有的==ApplicationContextInitializer==，调用initialize，来对IOC容器进行初始化扩展")])]),t._v(" "),a("li",[a("p",[t._v("遍历所有的listener调用contextprepared，EventPublishingRunListener通知所有的监听器contextprepared")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.itdu.tech/image//image-20210607012444451.png",alt:"image-20210607012444451"}})])])])]),t._v(" "),a("li",[a("p",[t._v("所有的监听器调用contextLoaded，通知所有的监听器contextLoaded")])])])]),t._v(" "),a("li",[a("p",[t._v("刷新IOC容器")]),t._v(" "),a("ul",[a("li",[t._v("创建容器中的所有组件（spring底层）")])])]),t._v(" "),a("li",[a("p",[t._v("刷新完成后afterRefresh")])]),t._v(" "),a("li",[a("p",[t._v("stopWatch.stop();结束监听器，获取应用创建时长")])]),t._v(" "),a("li",[a("p",[t._v("所有监听器调用listeners.started(context);方法，通知监听器项目启动完成")])]),t._v(" "),a("li",[a("p",[t._v("调用所有的runners，callRunners(context, applicationArguments);")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("获取容器中的==ApplicationRunner==")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FunctionalInterface")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationRunner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * Callback used to run the bean.\n    * @param args incoming application arguments\n    * @throws Exception on error\n    */")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationArguments")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("获取容器中的==CommandLineRunner==")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FunctionalInterface")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandLineRunner")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * Callback used to run the bean.\n    * @param args incoming main method arguments\n    * @throws Exception on error\n    */")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("合并所有Runner，并且按照@Order进行排序")])]),t._v(" "),a("li",[a("p",[t._v("遍历所有的Runner，调用run()方法")])])])]),t._v(" "),a("li",[a("p",[t._v("如果以上有异常，会调用监听器的listeners.failed(context, exception)方法，通知监听器有异常")])]),t._v(" "),a("li",[a("p",[t._v("调用所有监听器的listeners.running(context)方法，通知所有监听器项目进入running状态")])]),t._v(" "),a("li",[a("p",[t._v("如果running有问题，通知监听器failed，调用所有的监听器filed")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);